---
icon: ğŸ“†
slug: '210101'
title: '210101'
main_category: Log
category: 2021
tags: ['TypeScript', 'Storybook', 'React']
author: Younho Choo
author_title: younho9
author_url: https://github.com/younho9
author_image_url: https://avatars.githubusercontent.com/u/48426991
created_time: 2021-01-01
updated_time: 2021-02-15
---

## TypeScript + React + Storybookìœ¼ë¡œ ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°

### Design System vs Component Library

> â˜ ë””ìì¸ ì‹œìŠ¤í…œì€ ê³„ì† ì§„í™”í•˜ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ êµ¬ì„± ìš”ì†Œ ëª¨ìŒì´ê³ , ì¼ê´€ì„±ê³¼ ì†ë„ë¥¼ ë³´ì¥í•˜ëŠ” ê·œì¹™ì„ ë”°ë¥´ëŠ” ëª¨ë“  ì œí’ˆì„ ê°œë°œí•˜ê¸° ìœ„í•œ ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›(SSOT)ì´ë‹¤.

- ë””ìì¸ ì‹œìŠ¤í…œì€ ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„˜ì–´ì„œ ë””ìì¸ ì›ì¹™, ìŠ¤íƒ€ì¼ ê°€ì´ë“œ, íŒ¨í„´, í†¤, ê·œì¹™ê³¼ ëª…ì„¸ì„œ ë“±ì„ í¬í•¨í•œë‹¤.

### í”„ë¡œì íŠ¸ ìƒì„±

- `.gitignore` , `package.json` ìƒì„±

#### Storybook ì„¤ì¹˜í•˜ê¸°

```bash
npx -p @storybook/cli sb init --type react
```

- storybook ì‹œì‘í•˜ê¸°

```bash
yarn storybook
```

#### React peer dependencies

`@storybook/react` ê°€ `react` , `react-dom` ì„ peer-dependencyë¡œ ê°€ì§€ë¯€ë¡œ react, react-dom ì„ ì„¤ì¹˜í•´ì•¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ì„¤ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒì˜ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

```bash
Error: Cannot find module 'react-dom/package.json'
```

í•˜ì§€ë§Œ, dependency ì— ì§ì ‘ ì¶”ê°€í•˜ë©´, ê°œë°œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•œ ìœ ì €ê°€ `react` , `react-dom` ì—­ì‹œ ì„¤ì¹˜ ë°›ê²Œ ëœë‹¤. (ê²Œë‹¤ê°€ ì •í•´ì§„ ë²„ì „ìœ¼ë¡œ)

ë”°ë¼ì„œ ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ì‘ì„±ì ì…ì¥ì—ì„œëŠ” storybookì„ ì‹¤í–‰í•˜ëŠ” ê°œë°œ ì‹œì—ë§Œ ì´ ì˜ì¡´ì„±ì´ í•„ìš”í•˜ë¯€ë¡œ devDependencyì— ëª…ì‹œí•´ì•¼í•œë‹¤.

ë˜í•œ, ì´ ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” `react` , `react-dom` ê³¼ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë”°ë¼ì„œ peerDependencyì—ë„ ëª…ì‹œí•´ì•¼í•œë‹¤.

peerDependencyëŠ” ì´ ì˜ì¡´ì„±ê³¼ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ëœ»ì´ê³ , ìœ ì €ê°€ ì§ì ‘ ì„¤ì¹˜ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

devDependencyëŠ” í”„ë¡œì íŠ¸ì˜ ë¡œì»¬ì—ë§Œ ì„¤ì¹˜ë˜ê³  ë°°í¬ì‹œì—ëŠ” ìœ ì €ê°€ ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•Šê¸°ë•Œë¬¸ì— peerDependencyì™€ devDependencyì— ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„ ì¶”ê°€í•´ë„ ë¬´ë°©í•˜ë‹¤.

```bash
yarn add -D react react-dom
```

```json
// package.json
"peerDependencies": {
  "react": "17.0.1",
  "react-dom": "17.0.1",
  "styled-components": "5.2.1"
}
```

[storybookjs/storybook](https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#react-peer-dependencies)

[Yarn](https://classic.yarnpkg.com/en/docs/dependency-types/)

[Duplicate same dependency in package.json devDependencies and peerDependencies?](https://stackoverflow.com/questions/58244629/duplicate-same-dependency-in-package-json-devdependencies-and-peerdependencies)

#### TypeScriptë¡œ ì´ì „í•˜ê¸°

- typescript, react-docgen-typescript-loader ì„¤ì¹˜

  ```bash
  yarn add -D typescript react-docgen-typescript-loader
  ```

- `stories` typescript ë²„ì „ìœ¼ë¡œ ë³€ê²½

  create-react-app typescript í…œí”Œë¦¿ì— sb init ìœ¼ë¡œ ìƒì„±í•œ ts ë²„ì „ storiesë¡œ í…ŒìŠ¤íŠ¸

- `.storybook/main.js` ë³€ê²½

  ```javascript
  module.exports = {
  	stories: [
  		'../stories/**/*.stories.mdx',
  		'../stories/**/*.stories.@(js|jsx|ts|tsx)',
  	],
  	addons: ['@storybook/addon-links', '@storybook/addon-essentials'],
  	typescript: {
  		check: false,
  		checkOptions: {},
  		reactDocgen: 'react-docgen-typescript',
  		reactDocgenTypescriptOptions: {
  			shouldExtractLiteralValuesFromEnum: true,
  			propFilter: (prop) =>
  				prop.parent ? !/node_modules/.test(prop.parent.fileName) : true,
  		},
  	},
  };
  ```

- `tsconfig.json` ì¶”ê°€

  ```json
  {
  	"compilerOptions": {
  		"target": "es5",
  		"lib": ["dom", "dom.iterable", "esnext"],
  		"allowJs": true,
  		"skipLibCheck": true,
  		"esModuleInterop": true,
  		"allowSyntheticDefaultImports": true,
  		"strict": true,
  		"forceConsistentCasingInFileNames": true,
  		"noFallthroughCasesInSwitch": true,
  		"module": "esnext",
  		"moduleResolution": "node",
  		"resolveJsonModule": true,
  		"isolatedModules": true,
  		"noEmit": true,
  		"jsx": "react-jsx"
  	},
  	"include": ["stories"]
  }
  ```

[TypeScript](https://storybook.js.org/docs/react/configure/typescript)

### Rollupìœ¼ë¡œ ë²ˆë“¤ë§í•˜ê¸°

> â˜ ì›¹íŒ©ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ë²ˆë“¤ëŸ¬ë¼ë©´, ë¡¤ì—…ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìœ„í•œ ë²ˆë“¤ëŸ¬ë‹¤.

[Webpack and Rollup: the same but different](https://medium.com/webpack/webpack-and-rollup-the-same-but-different-a41ad427058c)

#### Rollup ì„¤ì •

- ì‚¬ìš©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸

```json
"devDependencies": {
  "babel-preset-react-app": "10.0.0", // create-react-appì—ì„œ ì‚¬ìš©í•˜ëŠ” babel ì„¤ì •
  "rollup": "2.35.1",
  "rollup-plugin-babel": "4.4.0", // babel ì‚¬ìš©ì„ ìœ„í•œ í”Œë¡œê·¸ì¸
  "rollup-plugin-cleaner": "1.0.0", // build ì „ì— dist í´ë” ì‚­ì œ
  "rollup-plugin-commonjs": "10.1.0", // CommonJSì˜ ëª¨ë“ˆ ì½”ë“œë¥¼ ES6ë¡œ ë³€í™˜í•˜ì—¬ ê²°ê³¼ë¬¼ì— í¬í•¨
  "rollup-plugin-node-resolve": "5.2.0", // ì¨ë“œíŒŒí‹° ëª¨ë“ˆì„ ì‚¬ìš©í•˜ê¸°ìœ„í•œ ìš©ë„
  "rollup-plugin-peer-deps-external": "2.2.4", // peerDependenciesë¥¼ ë²ˆë“¤ë§ëœ ê²°ê³¼ì— í¬í•¨í•˜ì§€ ì•ŠìŒ
}
```

- `rollup.config.js`

```javascript
import commonjs from 'rollup-plugin-commonjs';
import cleaner from 'rollup-plugin-cleaner';
import resolve from 'rollup-plugin-node-resolve';
import babel from 'rollup-plugin-babel';
import external from 'rollup-plugin-peer-deps-external';
import peerDepsExternal from 'rollup-plugin-peer-deps-external';

import pkg from './package.json';

const extensions = ['.js', '.jsx', '.ts', '.tsx'];

process.env.BABEL_ENV = 'production';

export default {
	input: './src/index.ts',
	plugins: [
		cleaner({targets: ['./dist/']}),
		peerDepsExternal(),
		resolve({extensions}),
		commonjs({
			include: 'node_modules/**',
		}),
		babel({
			extensions,
			include: ['src/**/*'],
			presets: [['react-app', {flow: false, typescript: true}]],
			runtimeHelpers: true,
		}),
	],
	output: [
		{
			file: pkg.module,
			format: 'es',
		},
	],
};
```

#### tsconfig.json & package.json ì„¤ì •

declarationì´ë€, ì»´í¬ë„ŒíŠ¸ë“¤ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” íƒ€ì… ì •ë³´ë“¤ì„ ì§€ë‹ˆê³  ìˆëŠ” íŒŒì¼.

ì´ëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ìƒì„±ì„ í•  ìˆ˜ ìˆë‹¤.

```bash
tsc --emitDeclarationOnly
```

ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— tsconfig.json ì„ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.

```json
{
	"compilerOptions": {
		"target": "es5",
		"lib": ["dom", "dom.iterable", "esnext"],
		"skipLibCheck": true,
		"esModuleInterop": true,
		"allowSyntheticDefaultImports": true,
		"strict": true,
		"forceConsistentCasingInFileNames": true,
		"module": "esnext",
		"moduleResolution": "node",
		"resolveJsonModule": true,
		"jsx": "react",
		"declaration": true,
		"declarationDir": "dist/types"
	},
	"include": ["src"],
	"exclude": ["**/*.stories.tsx"]
}
```

- `declaration`Â ê°’ì„Â `true`Â ,Â `declarationDir`Â ê²½ë¡œë¥¼Â `"dist/types"`Â ë¡œ,

- allowJs: ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ í˜¼ìš©ì„ í•˜ê³  ìˆë‹¤ë©´ declaration íŒŒì¼ì„ ë§Œë“¤ì§€ ëª»í•˜ë¯€ë¡œì œê±°.

- noEmit: ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜µì…˜ìœ¼ë¡œ ì œê±°.

- isolatedModules: ì•„ë¬´ ê°’ë„ ë‚´ë³´ë‚´ì§€ ì•ŠëŠ” íŒŒì¼ì„ ë°©ì§€í•˜ëŠ” ì˜µì…˜. ì œê±°

`stories.tsx`Â í™•ì¥ìëŠ” ëª¨ë‘ ë¬´ì‹œí•˜ë„ë¡Â `exclude`Â ì˜µì…˜ì„ ì„¤ì •

package.jsonì—ëŠ” Build ì»¤ë§¨ë“œë¥¼ ì¶”ê°€í•œë‹¤.

```json
"build": "rollup -c && tsc --emitDeclarationOnly",
```

package.jsonì—ì„œ module, types, files ë¥¼ ì¶”ê°€í•œë‹¤. nameì€ scopeë¥¼ ì‚¬ìš©í•œë‹¤.

```json
{
	"name": "@younho9/design-system",
	"module": "dist/index.js",
	"types": "dist/types/index.d.ts",
	"files": ["/dist"]
}
```

ë°°í¬ ëª…ë ¹ì–´

```bash
# npm publish
npm publish --access public # scopeë¥¼ ì‚¬ìš©í•  ë•Œ
```

### ì°¸ê³ ìë£Œ

[Do you think your component library is your design system? Think again](https://uxdesign.cc/do-you-think-your-component-library-is-your-design-system-think-again-7e2c902b5275)

[TypeScriptì™€ Storybookì„ ì‚¬ìš©í•œ ë¦¬ì•¡íŠ¸ ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°](https://velog.io/@velopert/design-system-using-typescript-and-storybook)

[ë””ìì¸ ì‹œìŠ¤í…œ ì†Œê°œ](https://www.learnstorybook.com/design-systems-for-developers/react/ko/introduction/)

[storybookjs/design-system](https://github.com/storybookjs/design-system)

[storybookjs/storybook](https://github.com/storybookjs/storybook/blob/next/MIGRATION.md)

[How to create a react component library with TypeScript, rollup.js and Storybook](https://medium.com/@dennisschneider/how-to-create-a-react-component-library-with-typescript-rollup-js-and-storybook-cc3fe95c9c44)

[Building a Design System Package With Storybook, TypeScript, and React in 15 Minutes](https://medium.com/better-programming/building-a-design-system-package-with-storybook-typescript-and-react-in-15-minutes-b5fd5711339e)

[Creating and publishing scoped public packages | npm Docs](https://docs.npmjs.com/creating-and-publishing-scoped-public-packages)
